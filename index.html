<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>投資紀錄管理 UI</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .section { margin-bottom: 32px; padding: 16px; border: 1px solid #ccc; border-radius: 12px; }
    table, th, td { border: 1px solid #aaa; border-collapse: collapse; padding: 6px; }
  </style>
</head>
<body>
  <h2>投資紀錄管理介面</h2>

  <div class="section">
    <h3>投資摘要</h3>
    <p>已投入金額：<span id="invested"></span></p>
    <p>資產現況：<span id="currentAsset"></span></p>
  </div>

  <div class="section">
    <h3>資產 / 報酬率 走勢</h3>
    <canvas id="chart" height="120"></canvas>
  </div>

  <div class="section">
    <h3>交易紀錄</h3>
    <table id="table"></table>
  </div>

  <div class="section">
    <h3>資產 / 報酬率 走勢</h3>
    <canvas id="chart" height="120"></canvas>
  </div>

<script>
const csvUrl = "https://raw.githubusercontent.com/<你的帳號>/<你的repo>/main/data/invest.csv";
let rows = [];

async function loadCSV() {
  const t = document.getElementById("table");
  const res = await fetch(csvUrl);
  const txt = await res.text();
  rows = txt.trim().split("\n").map(r => r.split(","));
  renderTable();
  updateSummary();
  renderChart();
}

function renderTable() {
  const t = document.getElementById("table");
  t.innerHTML = rows.map(r => `<tr>${r.map(c => `<td>${c}</td>`).join("")}</tr>`).join("");
}

function addRecord() {
  const d = date.value;
  const s = symbol.value;
  const p = price.value;
  const sh = shares.value;
  const a = amount.value;
  if (!d) return alert("日期必填");

  rows.push([d, s, p, sh, a]);
  renderTable();
  alert("已加入：請記得手動 commit 到 GitHub");
}

function updateSummary() {
  const invested = rows.reduce((t, r) => t + Number(r[4] || 0), 0);
  document.getElementById("invested").textContent = invested.toFixed(2);
  document.getElementById("currentAsset").textContent = invested.toFixed(2);
}

function renderChart() {
  const labels = rows.map(r => r[0]);
  const asset = rows.map((_, i) => rows.slice(0, i+1).reduce((x, y) => x + Number(y[4]||0), 0));

  new Chart(document.getElementById("chart"), {
    type: 'line',
    data: { labels, datasets: [{ label: '資產變化', data: asset }] },
  });
}

loadCSV();
</script>
</body>
</html>

</body>
</html>

