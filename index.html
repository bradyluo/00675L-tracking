<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>投資帳戶管理工具</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>📊 投資帳戶管理工具</h1>
            <p>追蹤富邦加權正2 (00675L) 及元大投資級公司債 (00720B)</p>
        </header>

        <main>
            <!-- 輸入介面 -->
            <section class="input-section">
                <h2>📝 交易記錄輸入</h2>
                <form id="transactionForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="date">日期 *</label>
                            <input type="date" id="date" required>
                        </div>
                        <div class="form-group">
                            <label for="transactionType">交易類別 *</label>
                            <select id="transactionType" required onchange="updateSecurityOptions()">
                                <option value="">-- 請選擇 --</option>
                                <option value="buy">買入</option>
                                <option value="sell">賣出</option>
                                <option value="dividend">配息</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="security">標的 *</label>
                            <select id="security" required>
                                <option value="">-- 請選擇 --</option>
                                <option value="00675L">富邦加權正2 (00675L)</option>
                                <option value="00720B">元大投資級公司債 (00720B)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="shares">張數 *</label>
                            <input type="number" id="shares" min="1" step="1" required placeholder="每張1000股">
                        </div>
                        <div class="form-group">
                            <label for="price">交易價格 *</label>
                            <input type="number" id="price" min="0" step="0.01" required placeholder="單位：元">
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn-submit">新增記錄</button>
                        </div>
                    </div>
                </form>
            </section>

            <!-- 資產投酬概況 -->
            <section class="summary-section">
                <h2>💰 資產投酬概況</h2>
                <div class="summary-grid">
                    <div class="summary-card">
                        <h3>總投資額</h3>
                        <p class="value" id="totalInvested">NT$ 0</p>
                    </div>
                    <div class="summary-card">
                        <h3>當前市值</h3>
                        <p class="value" id="currentValue">NT$ 0</p>
                    </div>
                    <div class="summary-card">
                        <h3>已收配息</h3>
                        <p class="value" id="totalDividend">NT$ 0</p>
                    </div>
                    <div class="summary-card">
                        <h3>未實現損益</h3>
                        <p class="value" id="unrealizedPnL">NT$ 0</p>
                    </div>
                    <div class="summary-card">
                        <h3>已實現損益</h3>
                        <p class="value" id="realizedPnL">NT$ 0</p>
                    </div>
                    <div class="summary-card">
                        <h3>總報酬率</h3>
                        <p class="value" id="totalReturn">0%</p>
                    </div>
                </div>

                <div class="holdings-section">
                    <h3>持倉明細</h3>
                    <table id="holdingsTable">
                        <thead>
                            <tr>
                                <th>標的</th>
                                <th>持倉張數</th>
                                <th>平均成本</th>
                                <th>當前價格</th>
                                <th>市值</th>
                                <th>損益</th>
                                <th>報酬率</th>
                            </tr>
                        </thead>
                        <tbody id="holdingsBody">
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 股價歷史走勢及技術分析 -->
            <section class="chart-section">
                <h2>📈 股價走勢及技術分析</h2>
                
                <div class="chart-controls">
                    <label>
                        <input type="checkbox" id="show00675L" checked onchange="updateChart()">
                        富邦加權正2 (00675L)
                    </label>
                    <label>
                        <input type="checkbox" id="showTWSE" checked onchange="updateChart()">
                        台灣加權指數 (TAIEX)
                    </label>
                </div>

                <canvas id="priceChart"></canvas>

                <div class="ma-divergence">
                    <h3>移動平均線乖離率</h3>
                    <table id="divergenceTable">
                        <thead>
                            <tr>
                                <th>標的</th>
                                <th>當前價格</th>
                                <th>60MA</th>
                                <th>60MA乖離率</th>
                                <th>240MA</th>
                                <th>240MA乖離率</th>
                            </tr>
                        </thead>
                        <tbody id="divergenceBody">
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 交易記錄表 -->
            <section class="records-section">
                <h2>📋 交易記錄</h2>
                <table id="recordsTable">
                    <thead>
                        <tr>
                            <th>日期</th>
                            <th>交易類別</th>
                            <th>標的</th>
                            <th>張數</th>
                            <th>價格</th>
                            <th>金額</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="recordsBody">
                    </tbody>
                </table>
            </section>
        </main>
    </div>

    <script src="script.js"></script>
</body>
</html>
